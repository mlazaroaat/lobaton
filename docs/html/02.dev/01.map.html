

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1. Creación de mapas &mdash; documentación de Lobatón - 0.1.0</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="3.2. Mapa de oferta y adjudicaciones" href="02.adjofer.html" />
    <link rel="prev" title="3. Documentación de desarrollo" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Lobatón
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01.intro/index.html">1. ¿Qué es Lobatón?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.intro/index.html#uso">2. Uso</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Documentación de desarrollo</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.1. Creación de mapas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conceptos-previos">3.1.1. Conceptos previos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uso-basico">3.1.2. Uso básico</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preliminares">3.1.2.1. Preliminares</a></li>
<li class="toctree-l4"><a class="reference internal" href="#carga-basica">3.1.2.2. Carga básica</a></li>
<li class="toctree-l4"><a class="reference internal" href="#icono">3.1.2.3. Icono</a></li>
<li class="toctree-l4"><a class="reference internal" href="#marcas">3.1.2.4. Marcas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#correcciones">3.1.2.5. Correcciones</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtros">3.1.2.6. Filtros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#utilidades">3.1.2.7. Utilidades</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#variantes">3.1.3. Variantes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#leaflet-markercluster">3.1.3.1. Leaflet.markercluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datos-que-no-son-geojson">3.1.3.2. Datos que no son GeoJSON</a></li>
<li class="toctree-l4"><a class="reference internal" href="#barra-de-progreso">3.1.3.3. Barra de progreso</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02.adjofer.html">3.2. Mapa de oferta y adjudicaciones</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Lobatón</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">3. Documentación de desarrollo</a> &raquo;</li>
        
      <li>3.1. Creación de mapas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/02.dev/01.map.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creacion-de-mapas">
<h1>3.1. Creación de mapas<a class="headerlink" href="#creacion-de-mapas" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Bajo este epígrafe se hará una exposición didáctica de cómo aprovechar
las ventajas de la librería <code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> para construir mapas.
De hecho, el <em>mapa de adjudicaciones y oferta educativa</em> es una aplicación
particular de su uso basada en tres niveles:</p>
<ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> en un nivel más bajo y absolutamente genérico.</li>
<li><code class="file docutils literal notranslate"><span class="pre">adjofer/maps/adjofer/map.js</span></code> para definir en concreto ila naturaleza
de mapa, cuáles son los iconos, cómo se dibujan a partir de los datos y
cómo varían en función de las correcciones y filtros que se apliquen sobre
tales datos. Su implementación es independiente de cuál sea la herramienta que
se use para construir la interfaz visual.</li>
<li><code class="file docutils literal notranslate"><span class="pre">interfaz/adofer.vuejs/scripts/main.js</span></code> que implementa una interfaz
atractiva haciendo uso de los dos niveles anteriores. Es el encargado de la
barra lateral.</li>
</ul>
<p>Trataremos aquí cómo crear un segundo nivel usando las herramientas que nos
brinda el primero, aunque para los ejemplos prácticos tendremos que introducir
algún aspecto propio del tercero, ya que el mapa se tendrá que ver de alguna
forma.</p>
<p>Más adelante, describiremos cómo usar <a class="reference internal" href="02.adjofer.html#adjofer"><span class="std std-ref">el segundo nivel implementado para
el mapa de adjudaciones</span></a> para construir una interfaz visual (tercer
nivel).</p>
<div class="section" id="conceptos-previos">
<h2>3.1.1. Conceptos previos<a class="headerlink" href="#conceptos-previos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Partimos de la necesidad de representar sobre un mapa una serie de entidades
cada una de las cuales tiene asociado un conjunto de datos. Para ello, podemos
usar <a class="reference external" href="https://leafletjs.com/">Leaflet</a> y colocar una marca por entidad, pero el uso de esta librería (u
otra equivalente) se limitará a permitirnos asignar un icono cuyo aspecto será
independiente de los valores concretos de los datos. Nuestra intención, sin
embargo, es ligar el aspecto del icono a los datos</p>
<p>En principio, distinguiremos estos conceptos.</p>
<dl class="docutils">
<dt><strong>Datos</strong></dt>
<dd>Incluyen las coordinadas de la entidad y otros datos característicos de los
que se quiere dejar constancia, total o parcialmente, a través del aspecto
visual de la marca.</dd>
<dt><strong>Marca</strong></dt>
<dd>Es la plasmación de la entidad (y sus datos) sobre el mapa.</dd>
<dt><strong>Clase</strong> (o <strong>tipo</strong>) de marca.</dt>
<dd>Todas las marcas que representen un mismo tipo de entidad pertenecen a una
misma clase de marca. Cada clase tiene, además, asociados un <em>sistema de
correcciones</em> y un <em>sistema de filtros</em>.</dd>
<dt><strong>Sistema de correcciones</strong></dt>
<dd>Sistema que permite registrar, aplicar y revertir correcciones aplicables
a los datos de la marca que constituyan una serie. Por ejemplo, en un centro
educativo, su oferta de enseñanzas es la lista de enseñanzas que se imparten
en él. Al usuario pueden interesarle unas enseñanzas, pero no otras, así que
su intención puede ser eliminar temporalmente esas enseñanzas que considera
irrelevantes a los efectos de su búsqueda.</dd>
<dt><strong>Sistema de filtros</strong></dt>
<dd>Sistema que permite fijar criterios para hacer desaparecer (o volver a
mostrar) marcas.</dd>
</dl>
<p class="rubric" id="dev-map-util">¿Cuándo puede resultarme útil leafext.js?</p>
<p>La librería se torna útil cuando, dado un conjunto de datos a representar sobre
un mapa:</p>
<ol class="arabic simple">
<li>Se quiere que los iconos que representan datos de un mismo tipo de entidad no
sean exactamente iguales, sino que partiendo de una plantilla sufran
alteraciones en función de loes valores de sus datos. Por ejemplo, que el
color dependa de lo grande que sea la magnitud del valor correspondiente.</li>
<li>Los datos puede sufrir correcciones por la interacción del usuario, lo cual
por supuesto podrá tener reflejo en el aspecto del icono, si éste dependía de
los datos cuyo valor ha cambiado.</li>
<li>Parte de los iconos pueden filtrarse y desaparecer, como consecuencia de las
decisiones del usuario.</li>
</ol>
<p>Y, por supuesto, cuando deseamos hacer todo esto conjuntamente. ;-)</p>
<p>Para que se haga una idea, esto es mapa desarrollado con la librería:</p>
<img alt="../_images/iconos.png" src="../_images/iconos.png" />
<p>Todos los iconos representan centros educativos y todos tienen una plantilla
común, pero sus detalles visuales particulares dependen de los datos que cada
uno tiene asociados (algunos son bilingües en inglés y muestran una bandera,
otros son de compensatoria y muestran un pequeño círculo azul, etc.).</p>
</div>
<div class="section" id="uso-basico">
<h2>3.1.2. Uso básico<a class="headerlink" href="#uso-basico" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Quizás pueda servirle de ayuda a la lectura, tener a la vista desde el
principio <a class="reference internal" href="#dev-map-ejmin"><span class="std std-ref">el ejemplo mínimo de aplicación</span></a>.</p>
</div>
<div class="section" id="preliminares">
<h3>3.1.2.1. Preliminares<a class="headerlink" href="#preliminares" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="datos">
<span id="dev-map-data"></span><h4>3.1.2.1.1. Datos<a class="headerlink" href="#datos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La idea es que disponemos de un conjunto de datos, que describen un conjunto de
entidades localizables en un mapa. Por ejemplo, la entidades pueden ser centros
educativos, de cada uno de lo cuales se conoce su situación geográfica y una
serie de características de interés. Nuestra intención es convertir cada
entidad en una marca dentro del mapa. Consideremos que el formato de los datos
es <a class="reference external" href="http://geojson.org/">GeoJSON</a>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
   <span class="nt">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
         <span class="nt">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
            <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">-5.9526</span><span class="p">,</span> <span class="mf">37.275475</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
            <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
            <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span>
         <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
         <span class="nt">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span>
            <span class="nt">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">-4.6389</span><span class="p">,</span> <span class="mf">37.58434</span><span class="p">]</span>
         <span class="p">},</span>
         <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Expectativa&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
            <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;ASIR&quot;</span><span class="p">],</span>
            <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;dificil&quot;</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">No es requisito que los datos tengan este formato, pero es un estándar
y <a class="reference external" href="https://leafletjs.com/">Leaflet</a> dispone de <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">un tipo de capa</a> que es capaz de
interpretarlos directamente generando una marca y conectándole los datos a
través del atributo <code class="docutils literal notranslate"><span class="pre">feature</span></code>. En cualquier caso, es posible utilizar un
formato cualquiera de datos, si creamos nosotros mismos la marca y le
asociamos sus datos a través de un atributo cualquiera.</p>
</div>
</div>
<div class="section" id="requerimientos">
<h4>3.1.2.1.2. Requerimientos<a class="headerlink" href="#requerimientos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como es obvio, el uso de la librería exige la carga previa de <a class="reference external" href="https://leafletjs.com/">Leaflet</a>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Leaflet --&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.4.0/dist/leaflet.css&quot;</span>
      <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==&quot;</span>
       <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/leaflet@1.4.0/dist/leaflet.js&quot;</span>
        <span class="na">integrity</span><span class="o">=</span><span class="s">&quot;sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==&quot;</span>
        <span class="na">crossorigin</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>A lo que podríamos añadir nuestros <em>plugins</em> favoritos de <a class="reference external" href="https://leafletjs.com/">Leaflet</a>, y la carga de
nuestra librería y el <em>script</em> donde desarrollaremos la creación del mapa.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Extensión para el soporte de iconos mutables --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../dist/leafext.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="c">&lt;!-- Script particular para este mapa --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;scripts/demo.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Las pautas para escribir este último <em>script</em> (<code class="file docutils literal notranslate"><span class="pre">scripts/demo.js</span></code>) (y el
propio documento <abbr title="HyperText Markup Language">HTML</abbr> claro está) son el propósito de este documento.</p>
<p>También, por supuesto, deberíamos incluir en el <abbr title="HyperText Markup Language">HTML</abbr> un elemento en el que
incrustar el mapa. Típicamente:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="carga-basica">
<span id="leafext-carga"></span><h3>3.1.2.2. Carga básica<a class="headerlink" href="#carga-basica" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para cargar el mapa y los datos podemos distinguir cuatro tareas distintas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">();</span>

<span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Y una capa GeoJSON para crear las marcas y conectarles los datos.</span>
<span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
   <span class="p">})</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">layer</span><span class="p">.</span><span class="nx">addData</span><span class="p">(</span><span class="nx">datos</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">La creación del icono, que hemos incluido dentro de la función
<code class="docutils literal notranslate"><span class="pre">crearIcono()</span></code>, a lo que dedicaremos el próximo apartado.</p>
</li>
<li><p class="first">La creación del mapa, que es la habitual con <a class="reference external" href="https://leafletjs.com/">Leaflet</a>.</p>
</li>
<li><p class="first">La creación de una capa para el tratamiento de los datos en formato
<em>GeoJSON</em>. En este caso se ha supuesto que los datos se obtuvieron
previamente de algún modo. Obsérvese cómo se usa la clase de marca
(<code class="docutils literal notranslate"><span class="pre">Centro</span></code>) e icono (<code class="docutils literal notranslate"><span class="pre">Icono</span></code>).  En caso de que el formato de entrada no
sea <a class="reference external" href="http://geojson.org/">GeoJSON</a>, podríamos usar simplemente <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#layergroup">L.LayerGroup</a> o <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#featuregroup">L.FeatureGroup</a>, aunque
tendríamos que ligar manualmente los datos a la marca.</p>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Vea cómo <a class="reference internal" href="#dev-map-no-geojson"><span class="std std-ref">tratar datos que no tengan formato GeoJSON</span></a>.</p>
</div>
</li>
<li><p class="first">La creación de la marca apropiada que trataremos más adelante.</p>
</li>
</ol>
</div>
<div class="section" id="icono">
<span id="crear-icono"></span><h3>3.1.2.3. Icono<a class="headerlink" href="#icono" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La definición del icono es la parte más engorrosa de toda la programación, en la medida
en que al ser un icono cuyo aspecto cambia según los datos particulares
asociados a cada marca o según las correcciones que el usuario imponga a estos
datos, hay que definir cuáles son las reglas de cambio. En un icono normal,
además de propiedades adicionales como el tamaño o el punto de anclaje, la propiedad
fundamental es aquella que define cuál es el icono: <code class="docutils literal notranslate"><span class="pre">iconUrl</span></code> para iconos que
se definen como imágenes, y <code class="docutils literal notranslate"><span class="pre">html</span></code> para iconos <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#divicon">L.DivIcon</a>. Para nuestros iconos
diversos y mutables, en cambio, hay que definir también cómo los datos se traducen
en detalles visuales del icono.</p>
<p>Para ilustrar la explicación usemos este sencillo, parecido a un <em>Chupa Chups</em>:</p>
<img alt="../_images/chupachups.png" src="../_images/chupachups.png" />
<p>El icono tiene dos detalles que depende de los datos asociados: el número que
representa el número de adjudicaciones; y el fondo del círculo que es un color
que depende del tipo de centro.</p>
<div class="section" id="definicion">
<h4>3.1.2.3.1. Definición<a class="headerlink" href="#definicion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para la definición de iconos, en principio, se ha manipulado la clase <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#divicon">L.DivIcon</a>
para que mediante opciones adicionales acepte una plantilla para generar iconos
más que un elemento <abbr title="HyperText Markup Language">HTML</abbr> que defina el aspecto invariante del icono.</p>
<dl class="class">
<dt id="MutableIcon">
<em class="property">class </em><code class="descname">MutableIcon</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableIcon" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Extensión de <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#divicon">L.DivIcon</a>
a fin de crear iconos definidos por una plantilla a la que se aplican
cambios en sus detalles según sean cambien los valores de sus opciones de
dibujo. Consulte <code class="xref js js-attr docutils literal notranslate"><span class="pre">Icon.options</span></code> para conocer cuales son las
opciones adicionales que debe proporcionar para que la clase sea capaz de
manejar iconos mutables.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Para crear el icono, use preferente la función <a class="reference internal" href="#L.utils.createMutableIconClass" title="L.utils.createMutableIconClass"><code class="xref js js-func docutils literal notranslate"><span class="pre">L.utils.createMutableIconClass()</span></code></a>.</p>
</div>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">updater</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.content&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">tipo</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content &quot;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">numadj</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Icon</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableIcon</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">className</span><span class="o">:</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span>
      <span class="nx">iconSize</span><span class="o">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">iconAnchor</span><span class="o">:</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;images/boliche.svg&quot;</span><span class="p">,</span>
      <span class="nx">updater</span><span class="o">:</span> <span class="nx">updater</span><span class="p">,</span>
      <span class="nx">converter</span><span class="o">:</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                            <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
                            <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">icon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Icon</span><span class="p">();</span>
</pre></div>
</div>
</dd></dl>

<p>Las opciones que debemos proporcionar en la creación de un tipo<a class="footnote-reference" href="#id13" id="id1">[1]</a> de icono son las siguientes:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">html</span></code> (o bien, <code class="docutils literal notranslate"><span class="pre">url</span></code>)</dt>
<dd><p class="first">Define la plantilla que se usará para crear el icono. Sobre esa plantilla se
realizarán variaciones determinadas por los valores concretos de los datos. Si
se proporciona <code class="docutils literal notranslate"><span class="pre">url</span></code> se entiende que es un fichero donde se ha almacenado
la definición. Un típico caso, sería pasar la <abbr title="Uniform Resource Locator">URL</abbr> a un <abbr title="Scalable Vector Graphics">SVG</abbr>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;images/centro.svg&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">html</span></code>, en cambio, debe usarse cuado la definición de la plantilla se hace:</p>
<ul>
<li><p class="first">A través de una cadena:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;content&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;arrow&quot;&gt;&lt;/div&gt;&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">A través de un <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment">DocumentFragment</a> que sería el objeto que obtendríamos
si hubiéramos incluido la definición a través de un <a class="reference external" href="template">template</a> <abbr title="HyperText Markup Language">HTML</abbr>:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">template</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;icono&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;arrow&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>que permitiría hacer en el código <em>Javascript</em> esta definición:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;icono&quot;</span><span class="p">).</span><span class="nx">content</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Directamente a través de un <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement">HTMLElement</a><a class="footnote-reference" href="#id14" id="id2">[2]</a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content&quot;</span><span class="p">;</span>
<span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="nx">arrow</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;arrow&quot;</span><span class="p">;</span>
<span class="nx">html</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">arrow</span><span class="p">);</span>
<span class="nx">content</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<div class="last admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Tenga presente que, cuando se proporciona una <abbr title="Uniform Resource Locator">URL</abbr>, el elemento
<abbr title="HyperText Markup Language">HTML</abbr> no está inmediatamente disponible y, en consecuencia no podemos
utlizar inmediatamente el construtcor resultante para empezar a crear
iconos. Trataremos más adelante qué hacer en estos casos.</p>
</div>
</dd>
</dl>
<dl class="docutils" id="dev-map-css">
<dt><code class="docutils literal notranslate"><span class="pre">css</span></code></dt>
<dd><p class="first">Cuando el icono se define a través de elementos <abbr title="HyperText Markup Language">HTML</abbr> (o sea, todos los
ejemplos anteriores, excepto el icono <abbr title="Scalable Vector Graphics">SVG</abbr>), es preciso indicar las reglas
<abbr title="Cascading Style Sheets">CSS</abbr> que permiten generar el icono:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">css</span> <span class="o">=</span> <span class="s2">&quot;images/chupachups.css&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>El fichero podría ser algo así<a class="footnote-reference" href="#id15" id="id3">[3]</a>:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">content</span> <span class="p">{</span>
   <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
   <span class="k">box-sizing</span><span class="p">:</span> <span class="kc">border-box</span><span class="p">;</span>
   <span class="k">height</span><span class="p">:</span> <span class="mi">70</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
   <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
   <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
   <span class="k">justify-content</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
   <span class="k">border</span><span class="p">:</span> <span class="kc">solid</span> <span class="mi">3</span><span class="kt">px</span> <span class="mh">#888</span><span class="p">;</span>
   <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">arrow</span> <span class="p">{</span>
   <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
   <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">width</span><span class="p">:</span> <span class="mi">10</span><span class="kt">%</span><span class="p">;</span> <span class="k">height</span><span class="p">:</span> <span class="mi">30</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">left</span><span class="p">:</span> <span class="mi">45</span><span class="kt">%</span><span class="p">;</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#444</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">normal</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">compensatoria</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#7be</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">chupachups</span> <span class="p">.</span><span class="nc">dificil</span> <span class="p">{</span>
   <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ebb</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">que provoca que el icono adquiera la forma de un <em>chupachups</em> y en el que se
pretende notar dos características: la cantidad de adjudicaciones (como
contenido del elemento <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>) y el tipo de centro como color de fondo.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">converter</span></code></dt>
<dd><p class="first">El aspecto del icono depende de los datos asociados, pero es bastante
probable que no dependa de todos, sino sólo de una parte. En nuestro ejemplo,
los datos son:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;adj&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
   <span class="s2">&quot;oferta&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
   <span class="s2">&quot;tipo&quot;</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>o sea, las adjudicaciones, la oferta y el tipo de centro. Sin embargo, el
icono se representa tomando el número de adjudicaciones y el tipo de centro;
la oferta no contribuye al aspecto en obsoluto. Por tanto, las <strong>opciones de
dibujo</strong> deberían ser:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">numadj</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
   <span class="nx">tipo</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p id="dev-map-converter-adj">Para definir cómo transformar <code class="docutils literal notranslate"><span class="pre">data</span></code> en <code class="docutils literal notranslate"><span class="pre">opts</span></code>, la librería provee de una
clase <a class="reference internal" href="#L.utils.Converter" title="L.utils.Converter"><code class="xref js js-class docutils literal notranslate"><span class="pre">L.utils.Converter()</span></code></a>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                     <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                     <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Aunque hayamos definido todo en una sola orden, hemos realizado tres tareas:</p>
<ol class="arabic">
<li><p class="first">Crear el objeto:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">]);</span>
</pre></div>
</div>
<p>que permite especificar cuáles son las opciones de dibujo de las que
dependerán los detalles visuales del icono: «<em>numadj</em>» y «»<em>tipo</em>».</p>
</li>
<li><p class="first">Definir cómo obtener <code class="docutils literal notranslate"><span class="pre">numadj</span></code> a partir de los datos:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</pre></div>
</div>
<p>qye significa: para obtener <code class="docutils literal notranslate"><span class="pre">numadj</span></code> (primer argumento) debemos
basarnos en el valor de <code class="docutils literal notranslate"><span class="pre">adj</span></code> (segundo argumento) y obtener la longitud
de su valor (que es el significado de la función que se ha usado en tercer
lugar).</p>
</li>
<li><p class="first">Definir cómo obtener <code class="docutils literal notranslate"><span class="pre">tipo</span></code>, para lo cual se ha hecho esta simple
definición:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>lo cual es posible, ya que si no especifica el nombre de la propiedad de
los datos, éste coincide con el de la opción de dibujo; y, si no se
especifica la función conversora, el valor no se transforma en absoluto.
Por tanto, lo anterior es equivalente a:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="nx">t</span> <span class="p">=&gt;</span> <span class="nx">t</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>Como el método <a class="reference internal" href="#L.utils.Converter.define" title="L.utils.Converter.define"><code class="xref js js-meth docutils literal notranslate"><span class="pre">L.utils.Converter.define()</span></code></a> devuelve el objeto mismo, es posible hacer
encadenamiento y convertir las tres instrucciones en una sola.</p>
<p>Hay, no obstante, dos puntualizaciones que hacer:</p>
<ol class="arabic">
<li><p class="first">Cuando la opción de dibujo depende de dos o más propiedades, puede usarse
un array. Por ejemplo, supongamos que una opción de dibujo fuera
<code class="docutils literal notranslate"><span class="pre">adjofer</span></code> que es la suma del número de adjudicaciones y el número de
enseñanzas. En ese caso, la definición podría haber sido:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;adjofer&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="s2">&quot;oferta&quot;</span><span class="p">],</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</pre></div>
</div>
<p>Téngase en cuenta que los argumentos de la función conversora siguen el
orden definido en el array. Por tanto, <code class="docutils literal notranslate"><span class="pre">a</span></code> representa al array de
adjudicaciones y <code class="docutils literal notranslate"><span class="pre">o</span></code> al de oferta.</p>
</li>
<li><p class="first">Cuando la propiedad está anidada dentro de los datos puede usarse la
notaciión de punto. Por ejemplo, supongamos que la definición de los datos
hubiera sido así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;adj&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
   <span class="s2">&quot;oferta&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
   <span class="s2">&quot;mod&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;tipo&quot;</span><span class="o">:</span> <span class="s2">&quot;normal&quot;</span><span class="p">.</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En ese caso la definición de <code class="docutils literal notranslate"><span class="pre">tipo</span></code> podría haberse hecho del siguiente
modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">converter</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">,</span> <span class="s2">&quot;mod.tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<div class="last admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si se desean aplicar correcciones, los valores de los atributos
de los datos que son arrays susceptibles de sufrir correcciones, deben
consultarse teniéndolo en cuenta. Vea más adelante <a class="reference internal" href="#dev-map-correctable"><span class="std std-ref">cómo hacerlo</span></a>.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updater</span></code></dt>
<dd><p class="first">Define la función que traslada los valores de las opciones de dibujo al
dibujo en sí:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">updater</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.content&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content &quot;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El contexto de la función es el elemento <abbr title="HyperText Markup Language">HTML</abbr> que representa al icono en la
página<a class="footnote-reference" href="#id16" id="id4">[4]</a>, y <code class="docutils literal notranslate"><span class="pre">o</span></code> es el objeto que contiene las opciones de dibujo.</p>
<div class="last admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Para la mejora del rendimiento, no se pasan todos los parámetros
sino sólo aquellos que han cambiado desde la última vez que se dibujó el
icono. Por ese motivo, debe definir la función teniendo en cuenta esto.
En la función de ejemplo, si no se pasa el <em>tipo</em>, no se modifica la clase
de «<em>content</em>», y si no se pasa <em>numadj</em>, no se modifica el número
contenido en el elemento <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>. Esto es así, porque no pasar la
opción significa que su valor no ha cambiado y, en consecuencia, ese
aspecto del dibujo debe permanecer igual.</p>
</div>
</dd>
</dl>
<p>Aunque puede definirse directamente el constructor es conveniente hacerlo a
través de la función:</p>
<dl class="function">
<dt id="L.utils.createMutableIconClass">
<code class="descclassname">L.utils.</code><code class="descname">createMutableIconClass</code><span class="sig-paren">(</span><em>name</em>, <em>options</em>, <em>updater</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.createMutableIconClass" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Facilita la construcción de clases de iconos. Cada clase está asociada
a un estilo de icono distinto.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) – Nombre identificativo para la clase de icono.</li>
<li><strong>options</strong> (<em>Object</em>) – Opciones de construcción de la clase.</li>
<li><strong>options.css</strong> (<em>string</em>) – Para un icono creado con CSS, el archivo .css. que define el aspecto.</li>
<li><strong>options.html</strong> (<em>string|DocumentFragment|Document</em>) – HTML que define la plantilla del icono. Se puede pasar como:  * Una cadena que contenga directamente el código HTML. * Un <code class="docutils literal notranslate"><span class="pre">DocumentFragment</span></code>, que sería lo que se obtiene como contenido de un <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code>. * Un <code class="docutils literal notranslate"><span class="pre">Document</span></code>, que sería lo que se obtiene de haber hecho una petición AJAX y quedarse cn la respuesta XML.</li>
<li><strong>options.url</strong> (<em>string</em>) – Alternativamente a la opción anterior, la URL de un archivo donde está definido el icono (p.e. un SVG).</li>
<li><strong>options.converter</strong> (<a class="reference internal" href="#L.utils.Converter" title="L.utils.Converter"><em>L.utils.Converter</em></a>) – Objeto <code class="xref py py-class docutils literal notranslate"><span class="pre">L.utils.Converter</span></code> para la conversión de los datos en opciones de dibujo.</li>
<li><strong>updater</strong> (<em>function</em>) – Función que actualiza el aspecto del icono a partir de los nuevos valores que tengan las opciones de dibujo. Toma las opciones de dibujo (o una parte de ellas) y modifica el elemento DIV (o SVG. etc.) del icono para que adquiera un aspecto adecuado. Debe escribirse teniendo presente que pueden no pasarse todas las opciones de dibujo, sino sólo las que se modificaron desde la última vez que se dibujó el icono. Por tanto, debe escribirse la función para realizar modificaciones sobre el aspecto preexistente del icono, en vez de escribirse para recrear el icono desde la plantilla</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">updater</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.content&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">tipo</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;content &quot;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">tipo</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">numadj</span><span class="p">)</span> <span class="nx">content</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">numadj</span><span class="p">;</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Icon</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">createMutableIconClass</span><span class="p">(</span><span class="s2">&quot;chupachups&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">iconSize</span><span class="o">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
   <span class="nx">iconAnchor</span><span class="o">:</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
   <span class="nx">css</span><span class="o">:</span> <span class="s2">&quot;styles/chupachups.css&quot;</span><span class="p">,</span>
   <span class="nx">html</span><span class="o">:</span> <span class="s1">&#39;&lt;div class=&quot;content&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;arrow&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">,</span>
   <span class="nx">converter</span><span class="o">:</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                         <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
                         <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">)</span>
   <span class="nx">updater</span><span class="o">:</span> <span class="nx">updater</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

<p>Por ello, la función <code class="docutils literal notranslate"><span class="pre">crearIcono()</span></code> que introdujimos antes podemos definirla
así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">crearIcono</span><span class="p">()</span> <span class="p">{</span>
   <span class="c1">// Definiciones de html, css, converter, updater</span>

   <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">createMutableIconClass</span><span class="p">(</span><span class="s2">&quot;chupachups&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">iconSize</span><span class="o">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">iconAnchor</span><span class="o">:</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
      <span class="nx">css</span><span class="o">:</span> <span class="nx">css</span><span class="p">,</span>
      <span class="nx">html</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span>
      <span class="nx">converter</span><span class="o">:</span> <span class="nx">converter</span><span class="p">,</span>
      <span class="nx">updater</span><span class="o">:</span> <span class="nx">updater</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Por supuesto, podemos seguir añadiendo opciones definidas para la
clase <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#icon">L.Icon</a> como es el
caso de <code class="docutils literal notranslate"><span class="pre">className</span></code>, <code class="docutils literal notranslate"><span class="pre">iconSize</span></code> o <code class="docutils literal notranslate"><span class="pre">iconAnchor</span></code>. En el caso de esta primera
opción no se ha definido valor alguno, pero cuando eso ocurre, la función
añade un nombre de clase igual al del nombre que se le da al icono («<em>chupachups</em>»),
de ahí que en el <abbr title="Cascading Style Sheets">CSS</abbr> que definía la forma del icono, se hubiera usado la
clase «<em>chupachups</em>».</p>
</div>
<p>Si regresa a consultar las opciones que deben suministrase para construir un
iconoi, comprobará que para definir cuál es el elemento  <abbr title="HyperText Markup Language">HTML</abbr> que define el
icono debe proporcionarse <em>html</em> o <em>url</em>. La primera lo proporciona
inmediatamente, pero la segunda exige una <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/Guide/AJAX">petición AJAX</a> que provocará que el
icono no esté plenamente operativo hasta que no se complete esta. En
consecuencia el <a class="reference internal" href="#leafext-carga"><span class="std std-ref">código básico propuesto</span></a> podría fallar si
en el momento de añadir los datos a la capa, no se ha completado la descarga del
archivo que contiene la definición del icono. No lo hace en nuestro ejemplo,
porque hemos usado la opción <em>html</em>. Para controlarlo, se disponen dos métodos
aplicables directamente sobre el construcor (o sea, métodos de clase y no
instancia):</p>
<dl class="method">
<dt id="Icon.isready">
<code class="descclassname">Icon.</code><code class="descname">isready</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Icon.isready" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Devuelve <code class="docutils literal notranslate"><span class="pre">true</span></code> si el icono es plenamente operativo. Por ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">();</span>
<span class="nx">Icono</span><span class="p">.</span><span class="nx">isready</span><span class="p">();</span>  <span class="c1">// Devolverá false si para definir el icono se uso la opción url.</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Icon.onready">
<code class="descclassname">Icon.</code><code class="descname">onready</code><span class="sig-paren">(</span><em>func_success</em>, <em>func_fail</em><span class="sig-paren">)</span><a class="headerlink" href="#Icon.onready" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Ejecuta la función suministrada como primer argumento cuando el constructor
esté listo o la segunda, si falla su su creación (p.e. porque no se puede
descargar el archivo dónde está definido el <abbr title="HyperText Markup Language">HTML</abbr>):</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">()</span>
<span class="nx">Icono</span><span class="p">.</span><span class="nx">onready</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;¿Está listo ya el icono?&quot;</span><span class="p">,</span> <span class="nx">Icono</span><span class="p">.</span><span class="nx">isready</span><span class="p">());</span> <span class="c1">// true.</span>
   <span class="kr">const</span> <span class="nx">icono</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">();</span>
   <span class="c1">// etc...</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

<p>CAMBIAR ESTO…</p>
<dl class="class">
<dt id="L.utils.Converter">
<em class="property">class </em><code class="descclassname">L.utils.</code><code class="descname">Converter</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Permite definir cómo un objeto se obtiene
a partir de las propiedades de otro.</p>
<p>Construye conversores entre objetos de distinto tipo.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> (<em>Array.&lt;String&gt;</em>) – Enumera las nombres de las propiedades que tiene el objeto de destino.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                            <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
                            <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="function">
<dt id="L.utils.Converter.define">
<code class="descclassname">L.utils.Converter.</code><code class="descname">define</code><span class="sig-paren">(</span><em>param</em>, <em>properties</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter.define" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Define cómo obtener una propiedad del objeto resultante.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first simple">
<li><strong>param</strong> (<em>String</em>) – El nombre de la propiedad.</li>
<li><strong>properties</strong> (<em>Array.&lt;String&gt;|String</em>) – Los nombres de las propiedades del objeto original que contribuyen a formar el valor de la propiedad del objeto resultante. Si la propiedad es una sola, puede evitarse el uso del <em>array</em> y escribir directamente el nombre. Si se omite este argumento, se sobreentiende que el nombre de la propiedad en el objeto original y el resultante es el mismo.</li>
<li><strong>func</strong> (<em>function</em>) – La función conversora. Debe definirse de modo que reciba como argumentos los valores de las propiedades que se enumeran en <code class="docutils literal notranslate"><span class="pre">properties</span></code>, conservando el orden.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Devuelve:</th><td class="field-body"><p class="first last"><strong>L.utils.Converter</strong> – El propio objeto de conversión o null, si la propiedad que se intenta definir, no se registró al crear el objeto.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="L.utils.Converter.defined">
<code class="descclassname">L.utils.Converter.</code><code class="descname">defined</code><a class="headerlink" href="#L.utils.Converter.defined" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Informa de si todas las propiedades habilitadas tienen definida una conversión</p>
</dd></dl>

<dl class="function">
<dt id="L.utils.Converter.disable">
<code class="descclassname">L.utils.Converter.</code><code class="descname">disable</code><span class="sig-paren">(</span><em>param</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter.disable" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Deshabilita una propiedad del objeto resultante. Esto significa
que cuando se obre la conversión del objeto, nunca se intentará
obtener el valor de esta propiedad.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first simple">
<li><strong>param</strong> (<em>string</em>) – Nombre de la propiedad.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Devuelve:</th><td class="field-body"><p class="first last"><strong>L.utils.Converter</strong> – El propio objeto.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="L.utils.Converter.enable">
<code class="descclassname">L.utils.Converter.</code><code class="descname">enable</code><span class="sig-paren">(</span><em>param</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter.enable" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Habilita una propiedad del objeto resultante.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first simple">
<li><strong>param</strong> (<em>string</em>) – Nombre de la propiedad.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Devuelve:</th><td class="field-body"><p class="first last"><strong>L.utils.Converter</strong> – El propio objeto.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="L.utils.Converter.enabled">
<code class="descclassname">L.utils.Converter.</code><code class="descname">enabled</code><a class="headerlink" href="#L.utils.Converter.enabled" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p><strong>type:</strong> Array.&lt;String&gt;</p>
<p>Las propiedades habilitadas para el objeto resultante.</p>
</dd></dl>

<dl class="function">
<dt id="L.utils.Converter.isDefined">
<code class="descclassname">L.utils.Converter.</code><code class="descname">isDefined</code><span class="sig-paren">(</span><em>param</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter.isDefined" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Informa de si la propiedad tiene definida la conversión.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first simple">
<li><strong>param</strong> (<em>String</em>) – El nombre de la propiedad.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Devuelve:</th><td class="field-body"><p class="first last"><strong>Boolean</strong> –</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="L.utils.Converter.params">
<code class="descclassname">L.utils.Converter.</code><code class="descname">params</code><a class="headerlink" href="#L.utils.Converter.params" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p><strong>type:</strong> Array.&lt;String&gt;</p>
<p>Las propiedades definidas para el objeto resultante.</p>
</dd></dl>

<dl class="function">
<dt id="L.utils.Converter.run">
<code class="descclassname">L.utils.Converter.</code><code class="descname">run</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.Converter.run" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Lleva a cabo la conversión del objeto suministrado. Sólo se
obtienen las propiedades que estén habilitadas y para las que
se pueda realizar la conversión, porque exista toda la
información requerida en el objeto.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first simple">
<li><strong>o</strong> (<em>Object</em>) – El objeto original</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Devuelve:</th><td class="field-body"><p class="first last"><strong>Object</strong> – El objeto resultante.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>… HASTA AQUÍ</p>
</div>
</div>
<div class="section" id="marcas">
<span id="leafext-marca"></span><h3>3.1.2.4. Marcas<a class="headerlink" href="#marcas" title="Enlazar permanentemente con este título">¶</a></h3>
<p><code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> define el constructor <code class="docutils literal notranslate"><span class="pre">L.MutableMarker</span></code> que permite definir
marcas con iconos mutables y a cuyo datos asociados se le pueden aplicar
correcciones y filtros como se verá más adelante.</p>
<dl class="class">
<dt id="MutableMarker">
<em class="property">class </em><code class="descname">MutableMarker</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Marca que soporta iconos mutables y permite realizar correcciones y filtros
sobre los datos asociados a ella.</p>
</dd></dl>

<p>Su definición requiere obligatoriamente incluir la opción <code class="docutils literal notranslate"><span class="pre">mutable</span></code>, cuyo
valor debe ser el atributo de la marca donde se guardarán los datos asociados.
Dado que usamos como origen de los datos un objeto <a class="reference external" href="http://geojson.org/">GeoJSON</a> y los añadimos al
mapa mediante una capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> , éstos aparecerán dentro de
<code class="docutils literal notranslate"><span class="pre">feature.properties</span></code>, de ahí que hayamos definido <code class="docutils literal notranslate"><span class="pre">Centro</span></code> así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>En cualquier caso, si no usa el formato <a class="reference external" href="http://geojson.org/">GeoJSON</a>,  y, en vez de ello, crea la
marca y añade artesanalmente los datos, asegúrese de colocar los datos en la
propiedad que ha señalado con <code class="docutils literal notranslate"><span class="pre">mutable</span></code>.</p>
<div class="section" id="acceso">
<h4>3.1.2.4.1. Acceso<a class="headerlink" href="#acceso" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En el <a class="reference internal" href="#leafext-carga"><span class="std std-ref">ejemplo de carga</span></a> la inserción de los datos en la
capa, genera para cada uno de ellos la marca que definimos en el método
<code class="docutils literal notranslate"><span class="pre">.pointToLayer()</span></code>. Ahora bien, ¿qué mecanismos tenemos para acceder a estas
marcas?</p>
<dl class="attribute">
<dt id="MutableMarker.store">
<code class="descclassname">MutableMarker.</code><code class="descname">store</code><a class="headerlink" href="#MutableMarker.store" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Es un atributo del constructor (o sea de clase) que almacena en un <em>array</em>
todas las marcas que se han definido con él:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="kr">const</span> <span class="nx">c</span> <span class="k">in</span> <span class="nx">Centro</span><span class="p">.</span><span class="nx">store</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hola, soy una marca de centro&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Advierta que todas esas marcas pueden no encontrarse en el mapa.
Por ejemplo, una que se haya filtrado.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="MutableMarker.invoke">
<code class="descclassname">MutableMarker.</code><code class="descname">invoke</code><span class="sig-paren">(</span><em>metodo</em>, <em>progress</em>, <em>arg1</em>, <em>arg2</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.invoke" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Permite aplicar un método de instancia a todas las marcas incluidas en <a class="reference internal" href="#MutableMarker.store" title="MutableMarker.store"><code class="xref js js-attr docutils literal notranslate"><span class="pre">MutableMarker.store</span></code></a>
Por ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Soy la marca que acabas de pulsar&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">));</span>
</pre></div>
</div>
<p>El segundo parámetro es una función que permite informar del progreso de la acción, en los
casos en que esta se demore mucho. La función recibe tres argumentos: la posición
de la marca de la que se ejcuta el método en el array <a class="reference internal" href="#MutableMarker.store" title="MutableMarker.store"><code class="xref js js-attr docutils literal notranslate"><span class="pre">MutableMarker.store</span></code></a>,
el total de marcas y el tiempo trascurrido en milisegundos desde que se comenzó a ejecutar
<code class="docutils literal notranslate"><span class="pre">.invoke()</span></code>. Lo que se hace internamente es durante 200ms lanzar sucesivamente el método
para cada marca y al cumplirse este tiempo, ejecutar la función <code class="docutils literal notranslate"><span class="pre">progress</span></code> y
suspender durante 50ms la ejecución. Esto permite informar al usuario de cuál es el progreso
y desbloquear la interfaz. Durante el primer segundo, se producen suspensiones, pero no
se ejecuta <em>progress</em>. Si se prevé que la acción no será muy penosa, pueden evitarse las
suspensiones y ejecutar de corrido el método sobre todas las márcanas dando
a progress el valor <code class="docutils literal notranslate"><span class="pre">null</span></code>. Si se desean realizar las interrupciones, para evitar el bloqueo,
pero no se quiere mostrar progreso alguna, puede usarse el valor <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="MutableMarker.getData">
<code class="descclassname">MutableMarker.</code><code class="descname">getData</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.getData" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Devuelve los datos asociados a la marca tomándolos del atributo que se
definió a través de la opción <em>mutable</em>.</p>
</dd></dl>

<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si en algún momento requiere consultar los datos y estos
han sufrido alguna corrección, tenga presente que <a class="reference internal" href="#dev-map-correctable"><span class="std std-ref">las propiedades
que sean *arrays* susceptibles de corrección deben consultarse de un
modo particular</span></a>.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">Ver también</p>
<p class="last">Cuando los datos son numerosos y, en consecuencia, las marcas
también, es imprescindible usar la extensión <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a> para agrupar las
marcas cercanas en una sola y que la marca conjunta vaya disgregándose a medida
que aumentamos la escala. Consulte <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">el uso de esta capa de clusters más
adelante</span></a>.</p>
</div>
<dl class="method">
<dt id="MutableMarker.changeData">
<code class="descclassname">MutableMarker.</code><code class="descname">changeData</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.changeData" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método de instancia que permite modificar directamente los datos de una marca
concreta:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">changeData</span><span class="p">({</span><span class="nx">tipo</span><span class="o">:</span> <span class="s2">&quot;dificil&quot;</span><span class="p">})</span><span class="o">:</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="MutableMarker.refresh">
<code class="descclassname">MutableMarker.</code><code class="descname">refresh</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.refresh" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método de instancia que actualiza el aspecto del icono en caso de que sea
necesario, esto es, porque desde la última vez que se refrescó se produjeron
cambios en las opciones de dibujo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">refresh</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="eventos">
<h4>3.1.2.4.2. Eventos<a class="headerlink" href="#eventos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Además de las eventos definidos por el propio <a class="reference external" href="https://leafletjs.com/">Leaflet</a>, como «click»:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Soy la marca que acabas de pulsar&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">));</span>
</pre></div>
</div>
<p><a class="reference internal" href="#MutableMarker" title="MutableMarker"><code class="xref js js-class docutils literal notranslate"><span class="pre">MutableMarker()</span></code></a> tiene definidos otros tipos de eventos:</p>
<dl class="docutils">
<dt><strong>dataset</strong></dt>
<dd><p class="first">Evento que se desencadena en el momento de asociar los datos a la marca:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Justamente ahora me acaba de asociar unos datos&quot;</span><span class="p">));</span>
</pre></div>
</div>
</dd>
<dt><strong>iconchange</strong></dt>
<dd><p class="first">Evento que se dispara cada vez que un icono cambia de aspecto como
consecuencia de un cambio en las opciones de dibujo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;iconchange&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Se redibuja </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
</pre></div>
</div>
<p>El evento presenta dos atributos relevantes: <em>opts</em> que contiene la lista de
opciones de dibujo que cambiaron entre un dibujado y el siguiente; y <em>reason</em>
que define la razón por la que se redibuja el icono. Puede tener dos valores:</p>
<blockquote class="last">
<div><ul class="simple">
<li>«<em>redraw</em>», el icono ya dibujado, se redibuja porque se forzó su dibujo
a través del método <a class="reference internal" href="#MutableMarker.refresh" title="MutableMarker.refresh"><code class="xref js js-meth docutils literal notranslate"><span class="pre">MutableMarker.refresh()</span></code></a> y había opciones
que habían cambiado desde el últimko <em>refresco</em>.</li>
<li>«<em>draw</em>», el icono se dibuja porque antes no lo estaba por alguna razón
(p.e. se encontraba filtrado) y durante el tiempo en que estuvo filtrado
cambiaron las opciones de dibujo, por lo que el aspecto del icono no es el
mismo que el que tenía éste cuando desapareció del mapa.</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Hay otros eventos más relacionados con las correcciones y los filtros.
que se ctarán a su debido tiempo.</p>
</div>
<p class="rubric" id="dev-map-ejmin">Ejemplo de aplicación</p>
<p>Con lo expuesto hasta ahora, seríamos capaces de construir un mapa con marcas
que ajusten su aspecto al valor de sus datos, esto es, que son capaces de
realizar <a class="reference internal" href="#dev-map-util"><span class="std std-ref">el primer punto con que expusimos la utilidad</span></a> de
la librería:</p>
<ul class="simple">
<li>Consulte <a class="reference external" href="https://sio2sio2.github.io/lobaton/docs/examples/minimo.html">en línea el resultado del ejemplo</a>.</li>
</ul>
</div>
</div>
<div class="section" id="correcciones">
<span id="leafext-corr"></span><h3>3.1.2.5. Correcciones<a class="headerlink" href="#correcciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em class="dfn">sistema de correcciones</em> permite alterar los datos iniciales de las
marcas según una serie de criterios establecidos por el usuario al interaccionar
con la interfaz visual. En el ejemplo anterior, podríamos desear «<em>eliminar
todas las adjudicaciones que sean de un colectivo determinado</em>». Si el colectivo
fuese el de <em>interinos</em>, es claro que las adjudicaciones pasarían de <strong>4</strong> a
<strong>3</strong> y de <strong>3</strong> a <strong>2</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las correcciones pueden aplicarse, exclusivamente, sobre atributos
cuyo valor sea un <em>array</em>.</p>
</div>
<p>Hay dos tipos diferentes de correcciones:</p>
<ol class="loweralpha simple">
<li>Las correcciones que eliminan elementos del <em>array</em>. como es el caso de la
corrección de ejemplo que se acaba de enunciar.</li>
<li>Las correcciones que añaden elementos al <em>array</em>.</li>
</ol>
<p>Es importante, además, tener presente que las correcciones se aplican a un tipo
de marca (p.e. la marca <code class="docutils literal notranslate"><span class="pre">Centro</span></code>) y que, en consecuencia, todas las marcas de
este tipo se verán afectadas por la correcciones. En un mismo mapa pueden
convivir varios tipos distintos de marcas y cada uno de ellos tendrá un sistema
de corrrecciones diferente.</p>
<div class="section" id="id5">
<h4>3.1.2.5.1. Definición<a class="headerlink" href="#id5" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para definir los criterios de corrección es preciso registrar cada criterio
sobre el constructor de la marca con el método de clase:</p>
<dl class="method">
<dt id="MutableMarker.register">
<code class="descclassname">MutableMarker.</code><code class="descname">register</code><span class="sig-paren">(</span><em>nombre</em>, <em>attr</em>, <em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.register" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que registra en el tipo de marca una corrección sobre
el atributo «<em>attr</em>» con nombre «<em>nombre</em>» según la función «<em>fn</em>». Por
ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {colectivo: [&quot;Interino&quot;]}</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>El código crea un corrección de nombre «<em>adjcol</em>» que se aplica sobre la
propiedad de los datos <code class="docutils literal notranslate"><span class="pre">adj</span></code>. Como es una corrección que pretende eliminar
elementos, se ejecutará la función suministrada por <code class="docutils literal notranslate"><span class="pre">fn</span></code> para cada uno de
los elementos del <em>array</em> <code class="docutils literal notranslate"><span class="pre">adj</span></code>, de manera que cuando devuelva <code class="docutils literal notranslate"><span class="pre">true</span></code> se
eliminará el elemento y cuando devuelva <code class="docutils literal notranslate"><span class="pre">false</span></code>, se conservará. Tal como está
escrita la función, se desecharán las adjudicaciones a colectivos que se
encuentren en la lista suministrada a través de las opciones. Además se incluye
un atributo <em>inv</em> para poder invertir el sentido de la corrección.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Una corrección sólo puede aplicarse a una única propiedad.</p>
</div>
</dd></dl>

<p>La función usa como contexto la marca sobre la que opera la corrección
y tiene tres argumentos:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">idx</span></code></dt>
<dd>El índice correspondiente al valor que comprueba la función.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">adj</span></code></dt>
<dd>que es el array completo. En el ejemplo, el array <code class="docutils literal notranslate"><span class="pre">adj</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">opts</span></code></dt>
<dd>que es un objeto que contiene las opciones que permiten determinar la
corrección y cuya obtención será tarea de la interfaz de usuario. Para la
definición de ejemplo, se necesitan los colectivos cuya adjudicación deseamos
conservar (propiedad <code class="docutils literal notranslate"><span class="pre">colectivo</span></code>) y una propiedad <code class="docutils literal notranslate"><span class="pre">inv</span></code> que sirve para
invertir el significado.</dd>
</dl>
<p>En caso de que la corrección sirva para añadir elementos, es necesario añadir la
propiedad <code class="docutils literal notranslate"><span class="pre">add</span></code> con valor <code class="docutils literal notranslate"><span class="pre">true</span></code> en la definición, y durante la aplicación
no se recorrerá el array elemento por elemento, sino que la función se ejecutará
una vez y deberá devolver un <em>array</em> con los elementos que se desean incorporar.
Como <code class="docutils literal notranslate"><span class="pre">idx</span></code> no tiene sentido en este caso, tomará el valor de <em>null</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;vt+&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">add</span><span class="o">:</span> <span class="kc">true</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
      <span class="c1">// Como nuestros datos son muy simples y no hay información alguna,</span>
      <span class="c1">// nos inventamos que en todos ha habido dos vacantes telefónicas</span>
      <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Interino&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">];</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Aunque tenga disponible el <em>array</em> dentro de la función, no añada
los nuevos elementos; limítese a devolverlos.</p>
</div>
</div>
<div class="section" id="aplicacion">
<h4>3.1.2.5.2. Aplicación<a class="headerlink" href="#aplicacion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El registro de una corrección no provoca ningún cambio en los datos: sólo la
define. Para llevar a efecto la corrección es necesario aplicar la corrección
mediante el método de clase:</p>
<dl class="method">
<dt id="MutableMarker.correct">
<code class="descclassname">MutableMarker.</code><code class="descname">correct</code><span class="sig-paren">(</span><em>nombre</em>, <em>opts</em>, <em>encadenamiento</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.correct" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que aplica una corrección proporcionando las opciones
para su aplicación:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">ccrrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">colectivo</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Prácticas&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">]});</span>
</pre></div>
</div>
<p>que sutirá efecto en todas las marcas de la clase <code class="docutils literal notranslate"><span class="pre">Centro</span></code>. En este caso, en
todas estas márcas  se <em>eliminará</em> del array de adjudicaciones (o sea, <code class="docutils literal notranslate"><span class="pre">adj</span></code>),
los elementos que no representan adjudicaciones a personal en prácticas o
interino.</p>
<dl class="docutils">
<dt>..seealso:: Para la explicación del significado del argumento</dt>
<dd><em>encadenamiento</em>, consulte más adelante el <a class="reference internal" href="#leafext-corr-enc"><span class="std std-ref">epígrafe dedicado al
encadenamiento</span></a>.`</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>La aplicación de la corrección no altera automáticamente el aspecto
de las marcas. Para hacerlo, debe aplicarse el método
<a class="reference internal" href="#MutableMarker.refresh" title="MutableMarker.refresh"><code class="xref js js-meth docutils literal notranslate"><span class="pre">MutableMarker.refresh()</span></code></a> sobre las marcas:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si con posterioridad a la aplicación, se crea una nueva marca de tipo
<code class="docutils literal notranslate"><span class="pre">Centro</span></code>, las correcciones aplicadas a la clase, se aplicarán sobre a la marca
en cuanto se conecten a ella los datos.</p>
</div>
</dd></dl>

<p id="dev-map-correctable">Se ha afirmado alegremente que se eliminan elementos del <em>array</em>, pero no es
cierto, puesto que si se eliminaran sin más no podría revertirse la corrección.
En realidad, todos los elementos siguen ahí, e incluso pueden haber aparecido
nuevos si hubo correcciones que los añadieron. Para consultar un <em>array</em> con
correcciones debe tenerse en cuenta lo siguiente:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.length</span></code></dt>
<dd>Devuelve la cantidad total de elementos: los preexistentes y los añadidos,
se hayan eliminado o no. En general, todas las funciones que se aplican al
<em>array</em> elemento por elemento (<a class="reference external" href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Array/forEach">.forEach()</a>, <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/JavaScript/Referencia/Objetos_globales/Array/map">.map()</a>, etc.) actúan de
esta forma. En consecuenta, recorrerán todos los elementos, pero no se podrá
conocer de ellos si está eliminado o no.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.total</span></code></dt>
<dd><p class="first">Devuelve el número total de elementos, descontados los eliminados. Por tanto,
la <a class="reference internal" href="#dev-map-converter-adj"><span class="std std-ref">conversión de adj en numadj</span></a> debimos haberla
hecho así:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">Converter</span><span class="p">([</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;tipo&quot;</span><span class="p">])</span>
                        <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;numadj&quot;</span><span class="p">,</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="nx">a</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
                        <span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;tipo&quot;</span><span class="p">);</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">..</span> <span class="pre">of</span></code></dt>
<dd><p class="first">Devuelve también todos los elementos, eliminados o no, pero cada elemento no
es el elemento original, sino un nuevo objeto que se caracteriza por lo
siguiente:</p>
<ul class="simple">
<li>Si el elemento original era un objeto, devuelve un objeto con las mismas
propiedades al que se ha añadido otra llamada <code class="docutils literal notranslate"><span class="pre">filters</span></code> que es un <em>array</em>
con los nombres de las correcciones que filtran el valor. En consecuencia,
un <code class="docutils literal notranslate"><span class="pre">filters</span></code> vacío supone que el valor no se ha filtrado.</li>
<li>Si el elemento original no era un objeto, sino un tipo primitivo, se
devuelve un objeto en cuyo atributo <code class="docutils literal notranslate"><span class="pre">value</span></code> se almacena el valor
original del elemento. También dispone del atributo <code class="docutils literal notranslate"><span class="pre">filters</span></code>.</li>
</ul>
<p>En ambos casos se dispone de un método <code class="docutils literal notranslate"><span class="pre">isPrimitive</span></code> para saber si el
elemento original era o no un objeto en su origen.</p>
<div class="last admonition note">
<p class="first admonition-title">Nota</p>
<p>Nótese que esta construcción actúa así, porque se ha alterado el
interador del <em>array</em> corregible. En consecuencia, si nuestra propiedad
se llama <code class="docutils literal notranslate"><span class="pre">adj</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">centro</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">adj</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">devolverá un array con los elementos descritos al tratar esta
construcción.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="reversion">
<h4>3.1.2.5.3. Reversión<a class="headerlink" href="#reversion" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para revertir una corrección, basta con usar:</p>
<dl class="method">
<dt id="MutableMarker.uncorrect">
<code class="descclassname">MutableMarker.</code><code class="descname">uncorrect</code><span class="sig-paren">(</span><em>nombre</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.uncorrect" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que revierte la corrección de nombre suministrado a
todas las marcas del tipo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">uncorrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>Tampoco en este caso se refresca el aspecto de las marcas. Por
tanto,  si quiere trasladar el cambio al aspecto de los iconos:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</dd></dl>

<p>Además, existe</p>
<dl class="method">
<dt id="MutableMarker.reset">
<code class="descclassname">MutableMarker.</code><code class="descname">reset</code><span class="sig-paren">(</span><em>deep</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.reset" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que desaplica todas las correcciones y vacía
<a class="reference internal" href="#MutableMarker.store" title="MutableMarker.store"><code class="xref js js-attr docutils literal notranslate"><span class="pre">MutableMarker.store</span></code></a>. Si se proprociona <code class="docutils literal notranslate"><span class="pre">deep</span></code> con valor
<code class="docutils literal notranslate"><span class="pre">true</span></code> desaplica también los filtros.</p>
</dd></dl>

</div>
<div class="section" id="encadenamiento">
<span id="leafext-corr-enc"></span><h4>3.1.2.5.4. Encadenamiento<a class="headerlink" href="#encadenamiento" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En algunos casos, podría darse la circunstancia de que la aplicación de una
corrección sobre una propiedad supusiera la aplicación automática de la
aplicación de otra corrección. Un ejemplo real podría ser el siguiente: si sólo
nos interesan enseñanzas bilingües (corrección sobre la oferta educativa),
entonces sólo nos deberían interesar las adjudicaciones a puestos bilingües
(corrección sobre las adjucaciones).  Como, desgraciadamente, no podemos llevar
a la práctica este ejemplo al estar utilizando una versión muy simplificada de
los datos, implementaremos un encadenamiento absurdo, pero que sirve para
ilustrar cómo se hace: <em>si nos interesan sólo puestos interinos, entonces no nos
interesa la enseñanza DAM</em>.</p>
<p>Sin encadenamiento, la definición de nuestras correcciones sería así:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">})</span>
      <span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;oferta&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {ens: [&quot;DAM&quot;] }</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">oferta</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oferta</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Como vemos, hemos definido la corrección «<em>of</em>» para que se desechen las
enseñanzas que coincidan con alguna de las que pasemos a través de las opciones.
Para el encadenamiento que queremos, podemos hacer la siguiente definición:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">adj</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">inv</span> <span class="o">^</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">adj</span><span class="p">[</span><span class="nx">idx</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
   <span class="p">},</span>
<span class="hll">   <span class="nx">autochain</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class="hll">   <span class="nx">chain</span><span class="o">:</span> <span class="p">[</span>
</span><span class="hll">      <span class="p">{</span>
</span><span class="hll">         <span class="nx">corr</span><span class="o">:</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span>
</span><span class="hll">         <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="k">if</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">colectivo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;Interino&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">               <span class="k">return</span> <span class="p">{</span><span class="nx">ens</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;DAM&quot;</span><span class="p">]}</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class="hll">         <span class="p">}</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">   <span class="p">]</span>
</span><span class="p">})</span>
     <span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span>  <span class="c1">// Esto no cambia en absoluto.</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;oferta&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {ens: [&quot;DAM&quot;] }</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">oferta</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oferta</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>O sea:</p>
<ul class="simple">
<li>Definimos una cadena de correcciones para <em>adjcol</em> a través del atributo
<code class="docutils literal notranslate"><span class="pre">chain</span></code>. El encadenamiento sólo define que podrá lanzarse automáticamente
la corrección <em>of</em>.</li>
<li>El atributo <code class="docutils literal notranslate"><span class="pre">autochain</span></code> permite definir si queremos que el encadenamiento
se lleve a cabo automáticamente al aplicar la corrección (<code class="docutils literal notranslate"><span class="pre">true</span></code>) o si
debemos especificarlo al aplicar la corrección.</li>
<li>Se debe definir una función que transforme las opciones de <em>adjcol</em> en
opciones de <em>of</em>. El contexto de esta función es el tipo de marca (<code class="docutils literal notranslate"><span class="pre">Centro</span></code>
en el ejemplo).</li>
<li>Si los valores de las opciones de <em>adjcol</em>, no provocan ningún efecto, entones
la función de transformación debe devolver <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
</ul>
<p>Además al aplicar las correcciones, podemos incluir un argumento adicional que
sobreescribe el valor de <code class="docutils literal notranslate"><span class="pre">autochain</span></code>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">ccrrect</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">colectivo</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Interino&quot;</span><span class="p">]},</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>en este caso se llevara a cabo el encadenamiento, a pesar de haber indicado
<code class="docutils literal notranslate"><span class="pre">false</span></code> antes.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Internamiente no se aplica una corrección <em>of</em>, sino un corrección
«<em>adjcol of</em>», por lo que podemos aplicar de forma independiente  y manual
una corrección <em>of</em>:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">correct</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">ens</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<p>Si se desea conocer para una corrección qué otras correcciones la han aplicado
automáticamente y con qué opciones, puede usarse el método:</p>
<dl class="method">
<dt id="MutableMarker.getAutoCorrect">
<code class="descclassname">MutableMarker.</code><code class="descname">getAutoCorrect</code><span class="sig-paren">(</span><em>nombre</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.getAutoCorrect" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Devuelve las correcciones manuales que han desencadenado automáticamente la
corrección de nombre suministrado:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">getAutoCorrect</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">);</span>  <span class="c1">// {adjcol: {ens: [&quot;DAM&quot;]}}</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="comprobacion-de-su-estado">
<h4>3.1.2.5.5. Comprobación de su estado<a class="headerlink" href="#comprobacion-de-su-estado" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para conocer cuál el estado de aplicación de las correcciones sobre las marcas,
la clase provee dos métodos del constructor:</p>
<dl class="method">
<dt id="MutableMarker.getCorrectStatus">
<code class="descclassname">MutableMarker.</code><code class="descname">getCorrectStatus</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.getCorrectStatus" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Devuelve el estado de las correcciones en forma de objeto con dos atributos:
<code class="docutils literal notranslate"><span class="pre">aplicadas.manual</span></code> donde se desglosan las
correcciones que se aplicaron manualmente; y <code class="docutils literal notranslate"><span class="pre">aplicadas.auto</span></code> donde se
desglosan las correcciones que se aplicaron automáticamente como consecuencia de
algún encadenamiento. El primer atributo es un objeto en el que las claves
son los nombres de las correcciones y los valores, sus opciones de
aplicación. El segundo objeto es algo más complejo, porque una misma
corrección ha podido aplicarse varias veces automáticamente. En este caso, las
claves son, de nuevo, los nombres de las correcciones, pero los valores son a
su vez un objeto en que las claves son los nombres de las correcciones
aplicadas manualmente que provocaron la aplicación automática y los valores
las opciones de aplicación automática. Por ejemplo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">aplicadas</span> <span class="o">=</span> <span class="nx">Centro</span><span class="p">.</span><span class="nx">getCorrectStatus</span><span class="p">()</span>
</pre></div>
</div>
<p>que si provoca que el valor de <em>aplicadas</em> fuera:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">manual</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">bilingue</span><span class="o">:</span> <span class="p">{</span><span class="nx">bil</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Inglés&quot;</span><span class="p">],</span> <span class="nx">inv</span><span class="o">:</span> <span class="kc">true</span><span class="p">}}</span>
<span class="p">}</span>
<span class="nx">auto</span><span class="o">:</span> <span class="p">{</span>
   <span class="nx">adjpue</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">bilingue</span><span class="o">:</span> <span class="p">{</span><span class="nx">puesto</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;00590107&quot;</span><span class="p">,</span> <span class="s2">&quot;DU590107&quot;</span><span class="p">]}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>significa que se aplicó manualmente una corrección llamada <em>bilingue</em> con las
opciones expresadas. Además, hay aplicada automáticamente una corrección llamada
<em>adjpue</em>, consecuencia de la aplicación manual de <em>bilingue</em> y cuyas opciones de
aplicación son las indicadas. Obsérvese que estas opciones son opciones de
aplicación de <em>adjpue</em>, no de la aplicación automática de bilingüe.</p>
</dd></dl>

<p>El segundo método útil para conocer las correcciones aplicadas está más
relacionado con saber si aplicar una corrección con unas determinads opciones de
aplicación, tendrá efecto en el mapa o será inútil porque el estado actual ya
supone directa o indirectamente la aplicación de esa corrección. Hay al menos
dos escenarios en los que esto es útil:</p>
<ol class="arabic simple">
<li>Si se han aplicado correcciones por alguna razón (p.e. porque al abrir el
mapa queremos que se apliquen sin que el usuario tenga que llevarlas a cabo)
y es necesario que la interfaz visual se ajuste a ese estado de correcciones
que no se han llevado a cabo a través de ella.</li>
<li>Cuando existe encadenamiento de correcciones, la aplicación manual de una
corrección <em>A</em>, desencadena la aplicación automática de otra corrección <em>B</em>.
De nuevo, esto puede afectar a la interfaz visual, si ésta permitía la
aplicación manual de <em>B</em>:</li>
</ol>
<p>Para llevar a cabo esto, existe el método del constructor:</p>
<dl class="method">
<dt id="MutableMarker.appliedCorrections">
<code class="descclassname">MutableMarker.</code><code class="descname">appliedCorrections</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.appliedCorrections" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Permite saber si la aplicación de una corrección es irrelevante, porque
ya existen otras que aplicadas que provacan ese efecto:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">appliedCorrections</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">colectivos</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Interino&quot;</span><span class="p">]},</span> <span class="s2">&quot;auto&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>El método admite tres argumentos: el nombre del filtro, las opciones de
aplicación y el tipo de comprobación que se desea realizar:</p>
<blockquote>
<div><ul class="simple">
<li><em>auto</em>, sólo comprueba si la aplicación requerida (<em>adjcol</em> con la
opción referido) ya está incluida en alguna de las aplicaciones
automáticas; y, por tanto, es inútil. Tiene utilidad para resolver el
segundo escenario.</li>
<li><em>manual</em>, sólo comprueba si la aplicación requerida ya está incluida
en la aplicación manual que se haya hecho anteriormente (si es que se ha
hecho). Tine utilidad para resolver el primer escenario.</li>
<li>Cualquier otro valor comprueba tanto en la aplicación manual como en las
automáticas.</li>
</ul>
</div></blockquote>
<p>Ahora bien, dado que cada corrección tiene una idiosincrasia propia, para que
sea posible comparar opciones de aplicación y determinar si unas implican otras,
es necesario que al registrar la corrección se indique cuál es el algoritmo.
Por tanto:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Desecha las enseñanzas que se facilitan.</span>
<span class="nx">Centro</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attr</span><span class="o">:</span> <span class="s2">&quot;oferta&quot;</span><span class="p">,</span>
   <span class="c1">// opts = {ens: [&quot;DAM&quot;] }</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">oferta</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oferta</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
   <span class="p">},</span>
   <span class="c1">// Si las opciones contienen al menos todas las enseñanzas</span>
   <span class="c1">// que tienen las nuevas, entonces la aplicación actual es más</span>
   <span class="c1">// restrictiva.</span>
<span class="hll">   <span class="nx">apply</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">newopts</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="k">for</span><span class="p">(</span><span class="kr">const</span> <span class="nx">ens</span> <span class="k">of</span> <span class="nx">newopts</span><span class="p">.</span><span class="nx">ens</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">         <span class="c1">// Hay una enseñanza en las nuevas opciones que no está en las actuales.</span>
</span><span class="hll">         <span class="k">if</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">ens</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ens</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class="hll">   <span class="p">}</span>
</span><span class="p">});</span>
</pre></div>
</div>
<p>La función compara las opciones actuales (<em>opts</em>) con las nuevas opciones
(<em>newopts</em>) y devuelve <code class="docutils literal notranslate"><span class="pre">true</span></code> si la aplicación de las nuevas opciones no
provocase ningún cambio en caso de poder aplicar la corrección sin desaplicar la
aplicación actual.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En caso de que no se facilite ninguna función, la comparación se
limitará a ver si las opciones de aplicación son iguales.</p>
</div>
</dd></dl>

</div>
<div class="section" id="leafext-event-corr">
<span id="id6"></span><h4>3.1.2.5.6. Eventos<a class="headerlink" href="#leafext-event-corr" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La aplicación y eliminación de correcciones sobre el tipo de marca tiene
asociados eventos.</p>
<dl class="docutils">
<dt><strong>correct:nombre</strong></dt>
<dd><p class="first">Evento aplicable sobre el constructor de la marca que se desencadena
cuando se aplica la corrección indicada con <em>nombre</em>:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;correct:adjcol&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">modo</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">auto</span><span class="o">?</span><span class="s2">&quot;automáticamente&quot;</span><span class="o">:</span><span class="s2">&quot;manualmente&quot;</span><span class="p">;</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Ha aplicado </span><span class="si">${</span><span class="nx">modo</span><span class="si">}</span><span class="sb"> una corrección </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">opts</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>El evento tiene los siguientes atributos relevantes (además de <code class="docutils literal notranslate"><span class="pre">target</span></code>
y <code class="docutils literal notranslate"><span class="pre">type</span></code>, claro está):</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Contiene el nombre de la corrección.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">auto</span></code></dt>
<dd>Booleano que informa de si la corrección se aplicó manualmente (<code class="docutils literal notranslate"><span class="pre">false</span></code>) o fue
consecuencia de un encadenamiento (<code class="docutils literal notranslate"><span class="pre">true</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">opts</span></code></dt>
<dd>Opciones con las que se aplicó la corrección.</dd>
</dl>
</dd>
<dt><strong>uncorrect:nombre</strong></dt>
<dd>Evento análogo al anterior que se desencadena al eliminar la corrección
especificada con <em>nombre</em>.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Es posible usar «<em>correct:*</em>» y «<em>uncorrect:*</em>» para que el evento
esté asociado a cualquier tipo de corrección.</p>
</div>
</div>
</div>
<div class="section" id="filtros">
<span id="leafext-filtro"></span><h3>3.1.2.6. Filtros<a class="headerlink" href="#filtros" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El <em class="dfn">sistema de filtros</em> posibilita eliminar entidades que cumplan con los
criterios que establezcamos. Para habilitar el sistema de filtros es necesario
añadir la opción <code class="docutils literal notranslate"><span class="pre">filter</span></code> al crear la clase de marca:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="nx">layer</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>En principio, le daremos como valor a <code class="docutils literal notranslate"><span class="pre">filter</span></code> la capa en la que se insertarán
las marcas (que habíamos llamado <code class="docutils literal notranslate"><span class="pre">layer</span></code>), aunque pueden facilitarse otros
valores (véase <a class="reference internal" href="#dev-map-style-filter"><span class="std std-ref">estilos de filtros</span></a>). Obrando así,
el efecto del filtrado es que desaparecerán totalmente del mapa las marcas
filtradas.</p>
<div class="section" id="id7">
<h4>3.1.2.6.1. Definición<a class="headerlink" href="#id7" title="Enlazar permanentemente con este título">¶</a></h4>
<p>De manera análoga a como se obra con las correcciones, antes de poder aplicar
filtros es necesario registrarlos:</p>
<dl class="method">
<dt id="MutableMarker.registerF">
<code class="descclassname">MutableMarker.</code><code class="descname">registerF</code><span class="sig-paren">(</span><em>nombre</em>, <em>attrs</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.registerF" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que define un filtro para las marcas definidas con
él. Por ejemplo, este filtro sirve para filtrar centros que tengan menos
de un número mínimo de adjudicaciones:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">registerF</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">attrs</span><span class="o">:</span> <span class="s2">&quot;adj&quot;</span><span class="p">,</span>
   <span class="nx">func</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getData</span><span class="p">().</span><span class="nx">adj</span><span class="p">.</span><span class="nx">total</span> <span class="o">&lt;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Para el registro del filtro es necesario un nombre (<em>adjmin</em> en el código de
ejemplo) y un objeto con dos propiedades:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">attrs</span></code></dt>
<dd>Es la lista de propiedades de los datos involucradas en el cálculo. Debe ser
un <em>array</em>, pero si es una propiedad sola, podemos ahorramos el <em>array</em> y
escribir directamente el nombre de la propiedad.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">func</span></code></dt>
<dd>Función que define si el centro se filtra (devuelve <code class="docutils literal notranslate"><span class="pre">true</span></code>) o no (devuelve
<code class="docutils literal notranslate"><span class="pre">false</span></code>). Su contexto es la propia marca que se desea comprobar.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="id8">
<h4>3.1.2.6.2. Aplicación<a class="headerlink" href="#id8" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para aplicar un filtro registrado, basta con pasar su nombre y cuáles son las
opciones de filtro, de forma análoga a como se hace con las correcciones.</p>
<dl class="method">
<dt id="MutableMarker.filter">
<code class="descclassname">MutableMarker.</code><code class="descname">filter</code><span class="sig-paren">(</span><em>nombre</em>, <em>opts</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.filter" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que aplica a todas las marcas de su tipo el filtro de
<em>nombre</em> indicado con las opciones de filtro indicadas. Por ejemplo, si
quisiéramos eliminar los centros sin adjudicaciones, deberíamos aplicar el
filtro «<em>adjmin</em>» del siguiente modo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">min</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
</pre></div>
</div>
<p>La aplicación del filtro afecta a las marcas que en ese momento se hayan creado,
afectará a las futuras y se recalculará cada vez que se aplique una corrección
que modifique alguna de las propiedades que listamos en <code class="docutils literal notranslate"><span class="pre">attrs</span></code>. Ahora bien,
como en el caso de las correcciones, los cambios sólo se trasladarán al dibujo
cuando refresquemos las marcas:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s2">&quot;refresh&quot;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id9">
<h4>3.1.2.6.3. Reversión<a class="headerlink" href="#id9" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para eliminar un filtro:</p>
<dl class="method">
<dt id="MutableMarker.unfilter">
<code class="descclassname">MutableMarker.</code><code class="descname">unfilter</code><span class="sig-paren">(</span><em>nombre</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.unfilter" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que desplica el filtro de <em>nombre</em> reseñado a las
marcas de su tipo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">unfilter</span><span class="p">(</span><span class="s2">&quot;adjmin&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Obviamente, deberemos refrescar para trasladar el efecto de la acción al
dibujo.</p>
</dd></dl>

</div>
<div class="section" id="id10">
<h4>3.1.2.6.4. Comprobación de su estado<a class="headerlink" href="#id10" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La marca dispone de dos métodos para hacer comprobaciones sobre los filtros
aplicados:</p>
<dl class="method">
<dt id="MutableMarker.hasFilter">
<code class="descclassname">MutableMarker.</code><code class="descname">hasFilter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.hasFilter" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que informa de si se ha aplicado el filtro:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">hasFilter</span><span class="p">(</span><span class="s2">&quot;adjcol&quot;</span><span class="p">);</span>  <span class="c1">// Devuelve true o false.</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="MutableMarker.getFilterStatus">
<code class="descclassname">MutableMarker.</code><code class="descname">getFilterStatus</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.getFilterStatus" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Métoodo del constructor qe devuelve un objeto cuyas  claves son los nombres
de los filtros aplicados; y cuyos valores, las opciones correspondientes de
aplicación:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">getFilterStatus</span><span class="p">();</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="leafext-event-filter">
<span id="id11"></span><h4>3.1.2.6.5. Eventos<a class="headerlink" href="#leafext-event-filter" title="Enlazar permanentemente con este título">¶</a></h4>
<p>De manera análoga a como hay definidos <a class="reference internal" href="#leafext-event-corr"><span class="std std-ref">eventos para la aplicación y
remoción de correcciones</span></a> también se definen para
la aplicación y remoción de correcciones, usando la misma sintaxis.</p>
<dl class="docutils">
<dt><strong>filter:nombre</strong></dt>
<dd><p class="first">Evento del constructor que se desencadena al aplicar el filtro de nombre
reseñado:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;filter:adjmin&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Ha aplicado el filtro </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">opts</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p class="last">El evento dispone de los mismos atributos que en el caso de las correcciones,
con la salvedad de <code class="docutils literal notranslate"><span class="pre">auto</span></code>, que no tiene sentido en este caso.</p>
</dd>
<dt><strong>unfilter:nombre</strong></dt>
<dd><p class="first">Evento del constructor que se desencadena al desaplicar el filtro de nombre
reseñado:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;unfilter:adjmin&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Ha desaplicado el filtro </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">opts</span><span class="p">);</span>
<span class="p">})</span><span class="o">:</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Puede usar <em>filter:*</em> y <em>unfilter:*</em> si quiere definir acciones
que se desencadenen con la aplicación o desaplicación de cualquier filtro.</p>
</div>
<p>Además de estos estos eventos aplicables sobre el constructor, las marcas
individuales definen los eventos <em>filtered</em> y <em>unfiltered</em> que se desencadenan
cuando la marca cambia de no filtrada a filtrada y de filtrada o no filtrada
respectivamente.</p>
<dl class="docutils">
<dt><strong>filtered</strong></dt>
<dd><p class="first">Evento asociado a cada marca individual que se desencadena al pasar un centro
de no estar filtrado a estarlo:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">centro</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;filtered&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Me acaba de filtrar el filtro &#39;</span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">&#39; por culpa de:`</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">opts</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>El evento añade dos atributos:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Contiene el nombre del filtro que provoca el cambio.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">opts</span></code></dt>
<dd>Contiene las opciones de filtro.</dd>
</dl>
</dd>
<dt><strong>unfiltered</strong></dt>
<dd>Evento asociado a cada marca individual que se desencadena al pasar un centro
de estar filtrado a no estarlo.</dd>
</dl>
</div>
<div class="section" id="estilos">
<span id="dev-map-style-filter"></span><h4>3.1.2.6.6. Estilos<a class="headerlink" href="#estilos" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Hasta el momento, el comportamiento de las marcas filtradas es desaparecer del
mapa y esto es debido a que dimos a la opción <code class="docutils literal notranslate"><span class="pre">filter</span></code> como valor la capa en
la que se agregan las marcas. Sin embargo, existe la alternativa de no hacer
desaparecer la marca, sino cambiar su aspecto para notar que está filtrada. para
ello podemos usar dos valores alternativos para la opción:</p>
<ul>
<li><p class="first">Un nombre, que hará que el elemento <abbr title="HyperText Markup Language">HTML</abbr> que representa la marca
filtrada se incluya en la clase <abbr title="Cascading Style Sheets">CSS</abbr> de tal nombre:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MUtableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="s2">&quot;filtrado&quot;</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Sin dentro del <abbr title="Cascading Style Sheets">CSS</abbr>, incluimos esta definición:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nx">filtrado</span> <span class="p">{</span>
   <span class="nx">filter</span><span class="o">:</span> <span class="nx">grayscale</span><span class="p">(</span><span class="mi">100</span><span class="o">%</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El efecto es que las marcas filtradas aparecerán en gris, y no en color.</p>
</li>
<li><p class="first">Una función que toma como contexto el elemento <abbr title="HyperText Markup Language">HTML</abbr> y lo modifica a
voluntad:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">filtered</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="nx">filtered</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="s2">&quot;grayscale(100%)&quot;</span><span class="p">;</span>
         <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="s2">&quot;filter&quot;</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>que tiene el mismo efecto que el código anterior. En concreto, para este
efecto, la librería ya tiene definida una función que puede usarse
directamente:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">MutableMarker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;feature.properties&quot;</span><span class="p">,</span>
      <span class="nx">filter</span><span class="o">:</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">grayFilter</span>
   <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
<p>Una vez definida la clase, es posible modificar el estilo posteriormente</p>
<dl class="method">
<dt id="MutableMarker.setFilterStyle">
<code class="descclassname">MutableMarker.</code><code class="descname">setFilterStyle</code><span class="sig-paren">(</span><em>estilo</em><span class="sig-paren">)</span><a class="headerlink" href="#MutableMarker.setFilterStyle" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Método del constructor que permite modificar el estilo de filtrado para los
iconos de marca de su tipo. El argumento <em>estilo</em> puede tomar los valores
descritos para la opción <em>filter</em> que se pasa al definir el constructor:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">Centro</span><span class="p">.</span><span class="nx">setFilterStyle</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>  <span class="c1">// Volvemos a ocultar los centros al filtrarlos.</span>
</pre></div>
</div>
</dd></dl>

<p>En este caso, a diferencia de cuando se aplican filtros y correcciones, el
redibujado de marca se hace automáticamente.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Cuando el estilo de filtro no elimina las marcas del mapa y se usa
una capa <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">MarkerClusterGroup</span></a>, el número del cluster
incluirá las marcas filtradas, ya que estas siguen en el mapa. Para evitarlo
y que sólo represente las marcas no filtradas puede cambiarse la función que
crea los iconos para los clusters y pasarla a través de la función
<code class="docutils literal notranslate"><span class="pre">iconCreateFunction</span></code>. La librería trae ya una hecha con este fin:</p>
<div class="last highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">iconFunctionCreate</span><span class="o">:</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">noFilteredIconCluster</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p class="rubric">Ejemplo de aplicación</p>
<ul class="simple">
<li>Consulte <a class="reference external" href="https://sio2sio2.github.io/lobaton/docs/examples/correcciones.html">en línea la variante del ejemplo anterior que añade una
corrección y un filtro</a></li>
</ul>
</div>
</div>
<div class="section" id="utilidades">
<h3>3.1.2.7. Utilidades<a class="headerlink" href="#utilidades" title="Enlazar permanentemente con este título">¶</a></h3>
<dl class="function">
<dt id="L.utils.noFilteredIconCluster">
<code class="descclassname">L.utils.</code><code class="descname">noFilteredIconCluster</code><span class="sig-paren">(</span><em>cluster</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.noFilteredIconCluster" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Redefine <code class="docutils literal notranslate"><span class="pre">iconCreateFunction</span></code> basándose en la definición original de
<a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>
para que el número del clúster sólo cuente los centros no filtrados.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first last simple">
<li><strong>cluster</strong> (<em>L.MarkerCluster</em>) – El cluster sobre el que se aplica la función.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="L.utils.grayFilter">
<code class="descclassname">L.utils.</code><code class="descname">grayFilter</code><span class="sig-paren">(</span><em>filtered</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.grayFilter" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Pone en escala de grises un icono filtrado o elimina
tal escala si ya no lo está.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first last simple">
<li><strong>filtered</strong> (<em>boolean</em>) – Si el icono está filtrado o no.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="L.utils.load">
<code class="descclassname">L.utils.</code><code class="descname">load</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="headerlink" href="#L.utils.load" title="Enlazar permanentemente con esta definición">¶</a></dt>
<dd><p>Realiza peticiones <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/Guide/AJAX">AJAX</a>. Las peticiones
serán asíncronas, a menos que no se proporcionen función de <em>callback</em> ni
<em>failback</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Argumentos:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> (<em>Object</em>) – Objeto que contiene los parámetros para realizar la petición.</li>
<li><strong>params.url</strong> (<em>String</em>) – URL de la petición.</li>
<li><strong>params.method</strong> (<em>String</em>) – Método HTTP de petición. Por defecto, será <code class="docutils literal notranslate"><span class="pre">GET</span></code>, si no se envía parámetros y <code class="docutils literal notranslate"><span class="pre">POST</span></code>, si sí se hace.</li>
<li><strong>params.params</strong> (<em>Object</em>) – Parámetros que se envían en la petición</li>
<li><strong>params.callback</strong> (<em>function</em>) – Función que se ejecutará si la petición tiene éxito. La función tendrá como único argumento el objeto <a class="reference external" href="https://developer.mozilla.org/es/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>.</li>
<li><strong>params.failback</strong> (<em>function</em>) – Función que se ejecutará cuando la petición falle. También admite como argumento un objeto <code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>.</li>
<li><strong>params.context</strong> (<em>Object</em>) – Objeto que usará como contexto las funciones de <em>callback</em> y <em>failback</em>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">load</span><span class="p">({</span>
   <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;image/centro.svg&#39;</span><span class="p">,</span>
   <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Éxito&quot;</span><span class="p">);</span> <span class="p">},</span>
   <span class="nx">failback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">);</span> <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="variantes">
<h2>3.1.3. Variantes<a class="headerlink" href="#variantes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Planteamos bajo este epígrafe algunas variantes interesantes sobre el uso ya
ilustrado.</p>
<div class="section" id="leaflet-markercluster">
<span id="dev-map-cluster"></span><h3>3.1.3.1. <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markercluster</a><a class="headerlink" href="#leaflet-markercluster" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando las marcas son numerosas, es indispensable usar esta extensión que
permite agrupar marcas cercanas e irlas desglosando según ampliamos la escala.
<code class="file docutils literal notranslate"><span class="pre">leafext.js</span></code> es compatible con una capa <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>, aunque
convendría tener claro cómo manejar datos en formato <a class="reference external" href="http://geojson.org/">GeoJSON</a> con ella. Lo más
sencillo es usar una capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> intermedia, que se encargue de interpretar
los datos:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 13 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
   <span class="nx">iconFunctionCreate</span><span class="o">:</span> <span class="nx">L</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">noFilteredIconCluster</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Obsérvese que no la añadimos al mapa.</span>
<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">})</span>
<span class="p">});</span>

<span class="c1">//Pasamos las marcas individuales a la capa de clústers</span>
<span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">interm</span><span class="p">);</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p>Tenga presente que la marca intermedia no se añade a la capa
<a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>,
sino las marcas individuales que se encuentran en ella. Por ese motivo, una vez
pasadas las marcas, eliminamos las marcas de la capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> para poder
seguir utilizándola como intermediaria.</p>
<p>Obsérvese que utilizando el código susodicho, se construyen todas las marcas
mientras se introducen en la capa intermedia y, ya creadas todas, se añaden del
tirón a la capa final. Una variante, quizás más interesante, es añadirlas a la
capa final, según las van creando la intermedia:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 14 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Obsérvese que no la añadimos al mapa.</span>
<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">}),</span>
   <span class="nx">onEachFeature</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p>La ventaja de este código sobre el anterior es que cada vez que creamos y
añadimos de modo efectivo una marca al mapa (o sea a la capa
<a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>) podemos lanzar un disparador con:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">layer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Creado y añadido el centro </span><span class="si">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">layer</span><span class="p">,</span><span class="nx">getData</span><span class="p">().</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
</pre></div>
</div>
<p>Con el primer codigo, en cambio, las marcas se creaban todas antes de añadirse
la primera al mapa.</p>
</div>
<div class="section" id="datos-que-no-son-geojson">
<span id="dev-map-no-geojson"></span><h3>3.1.3.2. Datos que no son <a class="reference external" href="http://geojson.org/">GeoJSON</a><a class="headerlink" href="#datos-que-no-son-geojson" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Cuando los datos no están en formato <a class="reference external" href="http://geojson.org/">GeoJSON</a>, la capa <a class="reference external" href="https://leafletjs.com/reference-1.4.0.html#geojson">L.GeoJSON</a> nos sirve de
poco y debemos de ser nosotros los que creemos la marca y añadamos a ella los
datos. Supongamos que los datos son estos:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;centros&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 1&quot;</span><span class="p">,</span>
         <span class="nt">&quot;lng&quot;</span><span class="p">:</span> <span class="mf">-5.9526</span><span class="p">,</span>
         <span class="nt">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">37.275475</span><span class="p">,</span>
         <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Suprimido&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
         <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;DAM&quot;</span><span class="p">,</span> <span class="s2">&quot;BACHILLERATO&quot;</span><span class="p">],</span>
         <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;normal&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Centro 2&quot;</span><span class="p">,</span>
         <span class="nt">&quot;lng&quot;</span><span class="p">:</span> <span class="mf">-4.6389</span><span class="p">,</span>
         <span class="nt">&quot;lat&quot;</span><span class="p">:</span> <span class="mf">37.58434</span><span class="p">,</span>
         <span class="nt">&quot;adj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Concursillo&quot;</span><span class="p">,</span> <span class="s2">&quot;Expectativa&quot;</span><span class="p">,</span> <span class="s2">&quot;Interino&quot;</span><span class="p">],</span>
         <span class="nt">&quot;oferta&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SMR&quot;</span><span class="p">,</span> <span class="s2">&quot;ASIR&quot;</span><span class="p">],</span>
         <span class="nt">&quot;tipo&quot;</span><span class="p">:</span> <span class="s2">&quot;dificil&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>o sea, los mismos datos de antes, pero sin el formato <a class="reference external" href="http://geojson.org/">GeoJSON</a>. En ese caso,
podríamos escribir un función que para cada centro creara su marca
correspondiente y la añadiera a la capa:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Icono</span> <span class="o">=</span> <span class="nx">crearIcono</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">Centro</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Marker</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
   <span class="nx">options</span><span class="o">:</span> <span class="p">{</span><span class="nx">mutable</span><span class="o">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">map</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">).</span><span class="nx">setView</span><span class="p">([</span><span class="mf">37.07</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.27</span><span class="p">],</span> <span class="mi">9</span><span class="p">);</span>
<span class="nx">L</span><span class="p">.</span><span class="nx">tileLayer</span><span class="p">(</span><span class="s1">&#39;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">maxZoom</span><span class="o">:</span> <span class="mi">18</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">featureGroup</span><span class="p">();</span>  <span class="c1">// También podria ser L.markerCluster.</span>

<span class="nx">funcion</span> <span class="nx">CrearMarca</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">([</span><span class="nx">d</span><span class="p">.</span><span class="nx">lat</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">lng</span><span class="p">]{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icon</span><span class="p">();</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
   <span class="p">});</span>
   <span class="k">delete</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lat</span><span class="p">;</span>
   <span class="k">delete</span> <span class="nx">d</span><span class="p">.</span><span class="nx">lng</span><span class="p">;</span>
   <span class="nx">m</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>  <span class="c1">// En consonancia con el valor de mutable.</span>

   <span class="k">return</span> <span class="nx">m</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span><span class="p">(</span><span class="kr">const</span> <span class="nx">d</span> <span class="k">of</span> <span class="nx">datos</span><span class="p">)</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">crearMarca</span><span class="p">(</span><span class="nx">d</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="barra-de-progreso">
<h3>3.1.3.3. Barra de progreso<a class="headerlink" href="#barra-de-progreso" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<p class="last">Corregir esto, porque se queda suspendido el navegador hasta ue acaba
la carga.</p>
</div>
<p>Los ejemplos que acompañan a <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.Markercluster</a> incluyen <a class="reference external" href="http://leaflet.github.io/Leaflet.markercluster/example/marker-clustering-realworld.50000.html">alguno con una
sencilla barra de progreso</a>
que informa de cómo va el procesamiento de datos y su adición al mapa en forma
de marca<a class="footnote-reference" href="#id17" id="id12">[5]</a>. Se basa en la las opciones <code class="docutils literal notranslate"><span class="pre">chuckedLoading</span></code> y
<code class="docutils literal notranslate"><span class="pre">chuckProgress</span></code> de <a class="reference external" href="https://github.com/Leaflet/Leaflet.markercluster">L.MarkerClusterGroup</a>, que son útiles cuando se añaden de una
sola vez muchos datos a la capa, como es el caso del primer ejemplo incluido en
el <a class="reference internal" href="#dev-map-cluster"><span class="std std-ref">apartado dedicado a discutir sobre este tipo de capa</span></a>. Sin embargo, si usamos otro tipo de capa o si utilizamos
ésta, pero añadiendo una a una las marcas., tal solución se vuelve
impracticable. Con todo, podemos construirnos nuestra propia solución con ayuda
del evento <em>layeradd</em>. Necesitamos un <abbr title="HyperText Markup Language">HTML</abbr> como este:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;progress&quot;</span><span class="p">&gt;&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;progress-bar&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;map&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Un <abbr title="Cascading Style Sheets">CSS</abbr> para la barra que tomamos del ejemplo original:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">#</span><span class="nn">progress</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">50</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">10</span><span class="kt">px</span><span class="p">);</span>
    <span class="k">left</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">50</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">100</span><span class="kt">px</span><span class="p">);</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">);</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">#</span><span class="nn">progress-bar</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#76A6FC</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Y añadir algo de <em>javascript</em> a las soluciones anteriores:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">layer</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">markerClusterGroup</span><span class="p">({</span>
   <span class="nx">showCoverageOnHover</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
   <span class="c1">// Al llegar a nivel 14 de zoom se ven todas las marcas.</span>
   <span class="nx">disableClusteringAtZoom</span><span class="o">:</span> <span class="mi">14</span><span class="p">,</span>
   <span class="nx">spiderfyOnMaxZoom</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>

<span class="c1">// Barra de progreso.</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="kr">const</span> <span class="nx">progress</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;progress&#39;</span><span class="p">),</span>
         <span class="nx">progressBar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;progress-bar&#39;</span><span class="p">),</span>
         <span class="nx">total</span> <span class="o">=</span> <span class="nx">datos</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
         <span class="nx">incr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>      <span class="c1">// Cada qué % se actualiza la barra.</span>

   <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="nx">progressBar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">;</span>

   <span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
         <span class="nx">step</span>  <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">total</span><span class="o">/</span><span class="mi">100</span><span class="o">/</span><span class="nx">incr</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>

   <span class="kd">function</span> <span class="nx">progressB</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">%</span><span class="nx">step</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">progress</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;block&quot;</span><span class="p">;</span>
         <span class="nx">progressBar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nx">total</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">progress</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">;</span>
         <span class="nx">layer</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">progressB</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="nx">layer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;layeradd&quot;</span><span class="p">,</span> <span class="nx">progressB</span><span class="p">);</span>
<span class="p">})();</span>

<span class="kr">const</span> <span class="nx">interm</span> <span class="o">=</span>  <span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">datos</span><span class="p">,</span> <span class="p">{</span>
   <span class="nx">pointToLayer</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Centro</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">icon</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Icono</span><span class="p">(),</span>
      <span class="nx">title</span><span class="o">:</span> <span class="nx">f</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>
   <span class="p">}),</span>
   <span class="nx">onEachFeature</span><span class="o">:</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">layer</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">interm</span><span class="p">.</span><span class="nx">clearLayers</span><span class="p">();</span>
</pre></div>
</div>
<p class="rubric">Notas al pie</p>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>O sea, una clase de icono que se utilizará en todas las marcas de un
mismo tipo.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Estamos reproduciendo la definición anterior, pero en este caso debemos
añadir un contenedor <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> extra.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>El por qué se usa la clase «<em>.chupachups</em>» en este trozo de <abbr title="Cascading Style Sheets">CSS</abbr> se
descubrirá más adelante.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Tenga presente que <a class="reference external" href="https://leafletjs.com/">Leaflet</a> envuelve la definición que con <code class="docutils literal notranslate"><span class="pre">html</span></code> o
<code class="docutils literal notranslate"><span class="pre">url</span></code> hayamos hecho en un elemento <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>, y es este elemento el que
representa <code class="docutils literal notranslate"><span class="pre">this</span></code>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[5]</a></td><td>Lo que no se incluye es el tiempo de descarga del fichero de datos que es
anterior a todo el proceso.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="02.adjofer.html" class="btn btn-neutral float-right" title="3.2. Mapa de oferta y adjudicaciones" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="3. Documentación de desarrollo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, José Miguel Sánchez Alés/José Manuel Bermudo Ancio

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>